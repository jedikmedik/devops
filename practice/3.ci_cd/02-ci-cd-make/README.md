#### Запуск деплоя с использованием утилиты make

В данной практике мы рассмотрим вариант деплоя приложения с помощью утилиты make. 

#### Подготовка

* Очистим сервер от предыдущей установки

Подключаемся к серверу xpaste:

```bash
ssh XPASTE_IP
```

Удаляем все из каталога /srv/www/xpaste:

```bash
rm -rf /srv/www/xpaste/*
```

* Создаем [Makefile](https://gitlab.slurm.io/devops/devops/raw/master/practice/3.ci_cd/02-ci-cd-make/Makefile) на сервере `sandbox` в корне проекта xpaste.

#### Практика

* Деплой приложения

Для запуска деплоя необходимо запустить утилиту make с ключом deploy:

```bash
make deploy
```
* Вывод справки

    ```bash
    make help
    ```

    * `build`       - локальная сборка проекта. 
    * `clean`       - удаление артефактов, созданных в результате локальной сборки.
    * `deploy`      - копирование проекта на удаленный сервер, сборка проекта, выполнение миграций БД и перезапуск служб nginx и puma.
    * `rollback`    - откат приложения на предыдущую версию и удаление текущей версии.


В результате выполнения этой команды код будет скопирован на сервер, в БД будут выполнены необходимые миграции, сгенерированы статические файлы и установлены необходимые зависимости.

* Проверяем доступность xpaste

В браузере открываем http://XPASTE_IP

Где XPASTE_IP это IP-адрес сервера xpaste

* Анализ результатов

Подключитесь к серверу xpaste по ssh:

```bash
ssh XPASTE_IP
```

Посмотрите структуру каталогов:

```bash
ll /srv/www/xpaste/
```


>
> :question: **Подумайте, какие стадии сборки проекта занимают больше всего времени и как их можно оптимизировать**
>
> :information_source: Для ответа на этот вопрос обратите внимание на структуру каталогов из следующей практики.
>
